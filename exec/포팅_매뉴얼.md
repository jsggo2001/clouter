# ì£¼ì˜ ì‚¬í•­

- MSAí”„ë¡œì íŠ¸ ì´ë¯€ë¡œ ê° ì„œë¹„ìŠ¤ë³„ë¡œ ì´ìš©ê°€ëŠ¥í•œ ìŠ¤í”„ë§ ë²„ì „ì´ ë‹¤ë¥´ë‹¤ ì—¬ê¸°ì„  17 ë²„ì „ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.
    (17 : member, chat, 11: eureka, apigateway, advertisement, contract, point)
- Spring BootëŠ” Java 17, Java 11 ì´ìƒì˜ ë²„ì „ì„ ìš”êµ¬í•œë‹¤.
- Jenkinsì—ëŠ” ì´ˆê¸°ì— ì„¤ì •í•œ Javaì˜ ë²„ì „ì— ì˜ì¡´ì ì´ë¯€ë¡œ, í”„ë¡œì íŠ¸ì— ë§ëŠ” Java ë²„ì „ì„ ì´ìš©í•œ Jenkinsë¡œ ì„¤ì¹˜í•  ê²ƒì„ ê¶Œì¥í•œë‹¤.
  - Jenkins ì„¤ì¹˜ ì™„ë£Œ í›„ì—ë„ Java ë²„ì „ì„ ì„¸íŒ…í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ë‹¤.

---

# Server êµ¬ì¶•

## 1. ì„œë²„ í™˜ê²½

### EC2

- EC2 ì ‘ì†
  - [MobaXterm](https://mobaxterm.mobatek.net/) ì„ ì´ìš©í•´ì„œ ì ‘ì† ê°€ëŠ¥
    - ssh, sftp ëª¨ë‘ ê°€ëŠ¥í•´ì„œ í¸ë¦¬
  - terminal(ë˜ëŠ” cmd)ì´ìš©
    - `ssh -i {pem_key_file} {ê³„ì •ëª…(ëŒ€ì²´ë¡œ unbuntu)}@{public_IP_address}`
  - FTPëŠ” FileZilla, sshëŠ” Puttyë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, MobaXtermì€ ì´ ë‘ ê°€ì§€ ê¸°ëŠ¥ì„ ëª¨ë‘ í¬í•¨

### Docker-compose

- Docker composeë¥¼ ì´ìš©í•´ì„œ ì„œë²„ì˜ êµ¬ì„± ìš”ì†Œ(nginx, MySQL, Jenkins)ì˜ imageë¥¼ í•œêº¼ë²ˆì— continerë¥¼ ë§Œë“¤ì–´ì„œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆìŒ
- Docker-composeì˜ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŒ

  ````
  version: "3.8"
  services:
  mysql:
  image: mysql:8.0
  container_name: mysql
  ports: - {ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸}:3306 # HOST:CONTAINER
  environment:
  MYSQL_ROOT_PASSWORD: {root ë¹„ë°€ë²ˆí˜¸}
  command: - --character-set-server=utf8mb4 - --collation-server=utf8mb4_unicode_ci
  volumes: # Mount to local directory - /var/lib/mysql:/var/lib/mysql

  jenkins: # Jenkins Container # image: jenkins/jenkins:lts
  image: jenkins/jenkins:2.317-jdk17-preview # java17
  container_name: jenkins
  volumes: - /usr/bin/docker:/usr/bin/docker - /var/run/docker.sock:/var/run/docker.sock - /var/jenkins_home:/var/jenkins_home
  ports: - {ì™¸ë¶€ì—ì„œ ì ‘ì†í•˜ëŠ” í¬íŠ¸ ë²ˆí˜¸}:8080
  privileged: true
  user: root
  restart: unless-stopped

  nginx: # Nginx Container
  image: nginx
  container_name: nginx
  ports: - 80:80 - 443:443
  volumes: - /etc/nginx/conf.d:/etc/nginx/conf.d - /etc/letsencrypt:/etc/letsencrypt
  restart: unless-stopped

  redis:  # Redis Container
    image: redis
    container_name: redis
    ports:
      - 6379:6379
    command: redis-server --requirepass ssafy --port 6379
    environment:
      - REDIS_REPLICATION_MODE=master
    volumes:
      - ./redis/data:/data
      - ./redis/conf/redis.conf:/usr/local/conf/redis.conf
    restart: unless-stopped

      ```
  ````

---

# Back-end

## 1. ê°œë°œ í™˜ê²½

### A. ê°œë°œ í™˜ê²½ ì •ë³´

Language | java 11, java 17
Framework | Spring Boot 2.7, Spring Boot 3.1
Build Tool | gradle 8.2.1
Database | mariaDB 10.11.0, mongoDB7.0.2, redis 7.2.3

### B. ê°œë°œ í™˜ê²½ ì„¸íŒ…

i. JDK

1.  [zulu-openjdk 17.0.8](https://www.azul.com/downloads/?version=java-17-lts&os=windows&architecture=x86-64-bit&package=jdk#zulu) ì—ì„œ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜
2.  cli í™˜ê²½ì—ì„œ ì„¤ì¹˜(ubuntu)

    ```
    # apt-add-repository ì„¤ì¹˜
    apt-get install software-properties-common

    # azulsystem ì €ì¥ì†Œ ì¶”ê°€
    apt-add-repository 'deb http://repos.azulsystems.com/ubuntu stable main'

    # ì„¤ì¹˜ë¥¼ ìœ„í•œ í‚¤ ë“±ë¡
    apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 0xB1998361219BD9C9

    # zulu jdk ê²€ìƒ‰(Optional)
    apt-get update && apt-cache search zulu

    # zulu jdk ì„¤ì¹˜(jdk-17)
    apt-get install zulu-17
    ```

ii. Querydsl

- ë¹Œë“œ ë° ë°°í¬ì˜ `build.gradle` ì°¸ê³ 

## 2. ë¹Œë“œ ë° ë°°í¬

í”„ë¡œì íŠ¸ì— í•„ìš”í•œ ì¸ì¦í‚¤ ì •ë³´ëŠ” main/resources/secret/application-secret.ymlì— í¬í•¨í•œë‹¤.
application-secret.ymlì—ëŠ” ë‹¤ìŒì˜ ì •ë³´ë“¤ì´ í¬í•¨ëœë‹¤.

```
# application-secret.yml

jwt:
  secretKey: {secret-key}

  access:
    expiration: 3600000
    header: Authorization

  refresh:
    expiration: 1209600000
    header: Authorization-refresh

spring:
    security:
        oauth2:
            client:
                registration:
                    google:
                        client-id: {client-id}
                        client-secret: {secret-key}
                        scope: profile, email

                    naver:
                        client-id: {client-id}
                        client-secret: {secret-key}
                        redirect-uri: {redirect-uri}
                        authorization-grant-type: authorization_code
                        scope: name, email, profile_image
                        client-name: Naver

                    kakao:
                        client-id: {client-id}
                        client-secret: {secret-key}
                        redirect-uri: {redirect-uri}
                        client-authentication-method: client_secret_post
                        authorization-grant-type: authorization_code
                        scope: profile_nickname, profile_image
                        client-name: Kakao

                    provider:
                        naver:
                            authorization_uri: https://nid.naver.com/oauth2.0/authorize
                            token_uri: https://nid.naver.com/oauth2.0/token
                            user-info-uri: https://openapi.naver.com/v1/nid/me
                            user_name_attribute: response

                        kakao:
                            authorization-uri: https://kauth.kakao.com/oauth/authorize
                            token-uri: https://kauth.kakao.com/oauth/token
                            user-info-uri: https://kapi.kakao.com/v2/user/me
                            user-name-attribute: id
# database setting(MySQL)
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://{server_address}:{port}/{schema_name}?useSSL=false&serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: {id}
    password: {password}

# S3 setting
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

# cloud front setting
cloud:
  aws:
    credentials:
      access-key: {IAM_accessKey}
      secret-key: {IAM_secretKey}
    region:
      static: {bucket_region}
    s3:
      bucket: {bucket_name}
    stack:
      auto: false
    cloudfront:
      domain: {domain_name}

```

í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œë¥¼ ìœ„í•œ `build.gradle` íŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```

plugins {
    id 'java'
    id 'org.springframework.boot' version '3.1.3'
    id 'io.spring.dependency-management' version '1.1.3'

    //    id "com.ewerk.gradle.plugins.querydsl" version "1.0.10"
    // (ì£¼ì˜) í•´ë‹¹ pluginì„ í¬í•¨í•˜ëŠ” ê²½ìš°, ë¹Œë“œê°€ ì•ˆ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ

}

group = 'com.ssafy'
version = '0.0.1-SNAPSHOT'

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client'
    implementation 'org.springframework.boot:spring-boot-starter-security'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'com.auth0:java-jwt:4.2.1'
    implementation 'io.jsonwebtoken:jjwt-api:0.11.5'
    //	xml parsing
    implementation 'javax.xml.bind:jaxb-api:2.3.0'
    //  Bcrypt
    implementation 'org.mindrot:jbcrypt:0.4'
    //  json parsing
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
    compileOnly 'org.projectlombok:lombok'
    runtimeOnly 'com.mysql:mysql-connector-j'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.11.5'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.11.5'
    annotationProcessor 'org.projectlombok:lombok'
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'

	//  querydsl
	implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
	annotationProcessor "com.querydsl:querydsl-apt:5.0.0:jakarta"
	annotationProcessor "jakarta.annotation:jakarta.annotation-api"
	annotationProcessor "jakarta.persistence:jakarta.persistence-api"
	//  aws s3
	implementation 'org.springframework.cloud:spring-cloud-starter-aws:2.2.6.RELEASE'
}

tasks.named('test') {
    useJUnitPlatform()
}

def querydslDir = "$buildDir/generated/querydsl"

sourceSets {
	main.java.srcDirs += [querydslDir]
}

tasks.withType(JavaCompile) {
	options.annotationProcessorGeneratedSourcesDirectory = file(querydslDir)
}

clean.doLast {
	file(querydslDir).deleteDir()
}

jar.enabled = false

```

### A. ìˆ˜ë™ ë¹Œë“œ

i. intelliJë¥¼ ì´ìš©í•œ ë¹Œë“œ

1. intelliJë¥¼ ì´ìš©í•´ì„œ í”„ë¡œì íŠ¸ í´ë”ë¥¼ open
2. ì˜¤ë¥¸ìª½ì˜ Gradle íƒ­ì—ì„œ `clean`ì„ í†µí•´ì„œ ì´ì „ ë‚´ìš© ì œê±°
3. ì˜¤ë¥¸ìª½ì˜ Gradle íƒ­ì—ì„œ `build`ë¥¼ í†µí•´ì„œ ë¹Œë“œ
4. í”„ë¡œì íŠ¸ ë‚´ `build/libs`ì— `.jar` íŒŒì¼ë¡œ ë¹Œë“œ ë¨
5. í„°ë¯¸ë„ì„ ì´ìš©í•´ì„œ `java -jar xxx.jar` ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥

ii. clië¥¼ ì´ìš©í•œ ë¹Œë“œ

1. `chmod +x gradlew`ë¥¼ í†µí•´ì„œ gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
2. `./gradlew clean build -x test`ë¥¼ ì‚¬ìš©í•´ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œ
3. í”„ë¡œì íŠ¸ ë‚´ `build/libs`ì— `.jar` íŒŒì¼ë¡œ ë¹Œë“œ ë¨
4. í„°ë¯¸ë„ì„ ì´ìš©í•´ì„œ `java -jar xxx.jar` ë°©ì‹ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥

### B. Dockerë¥¼ ì´ìš©í•œ ë°°í¬

1. ìœ„ì˜ ë°©ì‹ ì¤‘ í•œ ê°€ì§€ë¥¼ ì´ìš©í•´ì„œ ìˆ˜ë™ ë¹Œë“œ í›„ Dockerfileì„ í†µí•´ì„œ imageë¥¼ ë§Œë“¤ê³ , containerë¥¼ ì´ìš©í•´ì„œ ë°°í¬í•  ìˆ˜ ìˆë‹¤.
2. Dockerfileì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (build í´ë”ì™€ ê°™ì€ ë ˆë²¨ì— ì¡´ì¬)

   ```
   FROM azul/zulu-openjdk:17
   ARG JAR_FILE=build/libs/*.jar
   COPY ${JAR_FILE} app.jar
   EXPOSE 8200
   ENTRYPOINT ["java", "-jar", "app.jar"]
   ```

### C. Jenkinsë¥¼ ì´ìš©í•œ ìë™ ë°°í¬

1. Jenkinsë¥¼ ì´ìš©í•´ì„œ ë¹Œë“œ, docker ì´ë¯¸ì§€ ìƒì„± ë° ë°°í¬ë¥¼ ìë™í™” í•  ìˆ˜ ìˆë‹¤.
2. Jenkinsfileì€ ë‹¤ìŒê³¼ ê°™ë‹¤. (build í´ë”ì™€ ê°™ì€ ë ˆë²¨ì— ì¡´ì¬)

   ```
   pipeline {
       agent any

       // Jenkinsì˜ Java versionì´ 11ì¸ ê²½ìš°, Jenkinsì— Java 17ì„ ì„¤ì¹˜ í›„ ë‹¤ìŒì„ ì¶”ê°€í•´ì„œ ë²„ì „ì„ ë§ì¶¤
       tools {
           jdk("java-17")
       }

       stages {
           // Gradle ë¹Œë“œ ìŠ¤í…Œì´ì§€: Spring Boot í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
           stage('Gradle Build') {
               steps {
                   // 'backend' ë””ë ‰í„°ë¦¬ ë‚´ì—ì„œ ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
                   dir('backend') {
                       // gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
                       sh 'chmod +x gradlew'
                       // gradlewë¥¼ ì‚¬ìš©í•´ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•˜ë©° í…ŒìŠ¤íŠ¸ëŠ” ì œì™¸í•©ë‹ˆë‹¤.
                       sh './gradlew clean build -x test'
                   }
               }
           }

           // Docker ì´ë¯¸ì§€ ë¹Œë“œ ìŠ¤í…Œì´ì§€: Dockerfileì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
           stage('Docker Build') {
               steps {
                   dir('backend') {
                       // ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.
                       sh 'docker build -t solive_backend:latest .'
                   }
               }
           }

           // ë°°í¬ ìŠ¤í…Œì´ì§€: ì´ì „ì— ì‹¤í–‰ ì¤‘ì¸ 'back' ì»¨í…Œì´ë„ˆë¥¼ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
           stage('Deploy') {
               steps {
                   // ì‹¤í–‰ ì¤‘ì¸ 'back' ì»¨í…Œì´ë„ˆ ì œê±°
                   sh 'docker rm -f back'
                   // ìƒˆë¡œìš´ ì´ë¯¸ì§€ë¡œ 'back' ì»¨í…Œì´ë„ˆë¥¼ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰
                   sh 'docker run -d --name back -p 8200:8200 -u root solive_backend:latest'
               }
           }

           // ì™„ë£Œ ìŠ¤í…Œì´ì§€: ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” Docker ì´ë¯¸ì§€ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
           stage('Finish') {
               steps {
                   // ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” (dangling) ì´ë¯¸ì§€ë¥¼ ì°¾ì•„ ì œê±°í•©ë‹ˆë‹¤.
                   sh 'docker images -qf dangling=true | xargs -I{} docker rmi {}'
               }
           }
       }
   }
   ```

---

ì  í‚¨ìŠ¤ë¥¼ í†µí•œ ì„œë²„ê°„ ë°°í¬
---
pipeline {
    agent any

    stages {
        stage('Clone Repository') {
            steps {
                echo 'Branch : {ë¸Œëœì¹˜ëª…}'
                echo 'Clone Repository'
                git branch: '{ë¸Œëœì¹˜ëª…}', url: '{ê¹ƒë© ì£¼ì†Œ}', credentialsId: 'clout'
            }
        }

    
        stage('contract Docker Build') {
            steps {
                echo 'contract docker image build'
                sh 'cd ./backend/contract-service && docker build -t {ì´ë¯¸ì§€ëª…} .'
                sh 'docker push {ì´ë¯¸ì§€ëª…}'
            }
        }
        
        
        stage('contract Docker Stop and Remove') {
            steps {
                echo 'Stop and remove existing contract container'
                sh 'touch here.txt'
                sh 'ssh -i {pemí‚¤ ê²½ë¡œ} {ì ‘ì†í•˜ë ¤ëŠ” ì„œë²„ ì£¼ì†Œ} "docker stop {ì»¨í…Œì´ë„ˆ ì´ë¦„} || true"'
                sh 'ssh -i {pemí‚¤ ê²½ë¡œ} {ì ‘ì†í•˜ë ¤ëŠ” ì„œë²„ ì£¼ì†Œ} "docker rm -f {ì»¨í…Œì´ë„ˆ ì´ë¦„} || true"'
                sh 'ssh -i {pemí‚¤ ê²½ë¡œ} {ì ‘ì†í•˜ë ¤ëŠ” ì„œë²„ ì£¼ì†Œ} "docker rmi -f {ì´ë¯¸ì§€ëª…} || true"'
            }
        }
    
    
        stage('contract Docker run') {
            steps {
                echo 'Run backend docker container'
                sh 'ssh -i {pemí‚¤ ê²½ë¡œ} {ì ‘ì†í•˜ë ¤ëŠ” ì„œë²„ ì£¼ì†Œ} "docker run -d -p 8890:8890 -e EUREKA_HOSTNAME={ìœ ë ˆì¹´ í˜¸ìŠ¤íŠ¸ ì£¼ì†Œ} --name {ì»¨í…Œì´ë„ˆ ì´ë¦„} {ì´ë¯¸ì§€ëª…}"'
            }
        }
        
        
        stage('Docker clear') {
            steps{
                sh "docker system prune -af"
            }
        }
    }
}
---
# Front-end

## 1. ê°œë°œ í™˜ê²½

### A. ê°œë°œ í™˜ê²½ ì •ë³´

- React: 18.2.0
- Node.js: 18.17.1
- Typescript: 5.0.2
- Vite: 4.4.5
- Tailwindcss: 3.3.3
- Recoil: 0.7.7
- pnpm: 8.7.4
- VSCode: 1.81.1

### B. ê°œë°œ í™˜ê²½ ì„¸íŒ…

**Language |** Dart  3.1.3

**Framework |** flutter 3.13.7 
    
<details>
<summary>Library </summary>
<div markdown="1">       
  numberpicker: ^2.1.2
  cupertino_icons: ^1.0.2
  google_fonts: ^6.1.0
  percent_indicator: ^4.0.1
  intl: ^0.18.1
  syncfusion_flutter_sliders: ^23.1.42
  syncfusion_flutter_core: ^23.1.42
  flutter_launcher_icons: ^0.13.1
  syncfusion_flutter_datepicker: ^23.1.43
  dropdown_button2: ^2.3.9
  multi_select_flutter: ^4.1.3
  animated_toggle_switch: ^0.8.0
  image_picker: ^1.0.4
  multiple_images_picker: ^1.0.1
  permission_handler: ^11.0.1
  multi_image_picker: ^4.8.01
  flutter_riverpod: ^2.4.4
  fluttertoast: ^8.2.2
  signature: ^5.4.0
  syncfusion_flutter_signaturepad: ^23.1.42
  image_gallery_saver: ^2.0.3
  change_app_package_name: ^1.1.0
  url_launcher: ^6.2.1
  carousel_slider: ^4.2.1
  flutter_inset_box_shadow: ^1.0.8
  flutter_animate: ^4.2.0+1
  stomp_dart_client: ^1.0.0
  web_socket_channel: ^2.4.0
  daum_postcode_search: ^0.0.2
  flutter_inappwebview: ^5.7.2+3
  infinite_scroll_pagination: ^4.0.0
  currency_text_input_formatter: ^2.1.10
  brasil_fields: ^1.14.0
  firebase_core: ^2.21.0
  firebase_messaging: ^14.7.3
  flutter_local_notifications: ^16.1.0
  syncfusion_flutter_pdf: ^23.1.43
  open_file: ^3.3.2
  flutter_staggered_grid_view: ^0.7.0
  loading_indicator: ^3.1.1
  flutter_dotenv: ^5.1.0
  http: ^1.1.0
  pinput: ^3.0.1
  format: ^1.4.0
  flutter_animated_icons: ^1.0.1
  http_status_code: ^0.0.2
  shared_preferences: ^2.2.2
  dio: ^5.3.3
  http_parser: ^4.0.2
  flutter_cache_manager: ^3.3.1
  path_provider: ^2.1.1
  device_info: ^2.0.0
</div>
</details>

<br></br>

## ğŸ’» êµ¬ë™ ë°©ë²•

1. Clone Project

```
git clone https://lab.ssafy.com/s09-bigdata-recom-sub2/S09P22A305.git
```

2. change path to /front_temp/frontend

```
flutter pub get
```
3. create .env file

```
# .env
CLOUT_APP_BASE_URL='https://clouter.kr'
```
4.frontend start

```
flutter run
```
